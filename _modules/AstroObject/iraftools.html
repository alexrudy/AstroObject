

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>AstroObject.iraftools &mdash; AstroObject 0.5-b3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.5-b3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="AstroObject 0.5-b3 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">AstroObject 0.5-b3 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for AstroObject.iraftools</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># </span>
<span class="c">#  iraftools.py</span>
<span class="c">#  AstroObject</span>
<span class="c">#  </span>
<span class="c">#  Created by Alexander Rudy on 2012-04-19.</span>
<span class="c">#  Copyright 2012 Alexander Rudy. All rights reserved.</span>
<span class="c">#  Version 0.5-b3</span>
<span class="c"># </span>
<span class="sd">u&quot;&quot;&quot;</span>
<span class="sd">:mod:`iraftools` – IRAF integration facility</span>
<span class="sd">============================================</span>

<span class="sd">This module provides an interface for using :mod:`AstroObject` with PyIRAF. For documentation of the individual methods provided by this module, see :class:`IRAFToolsMixin`. The next two sections will provide a brief overview of the use of :mod:`iraftools`.</span>

<span class="sd">To use :mod:`iraftools`, use the :func:`UseIRAFTools` function.</span>

<span class="sd">.. autofunction::</span>
<span class="sd">    AstroObject.iraftools.UseIRAFTools</span>

<span class="sd">.. _IRAFTools_Filetypes:</span>

<span class="sd">File types in :mod:`iraftools`</span>
<span class="sd">------------------------------</span>

<span class="sd">There are three types of FITS files provided by :mod:`iraftools`:</span>

<span class="sd">.. describe:: in-file</span>
<span class="sd">    </span>
<span class="sd">    :meth:`infile &lt;IRAFToolsMixin.iraf.infile&gt;` and :meth:`inatfile &lt;IRAFToolsMixin.iraf.inatfile&gt;`</span>
<span class="sd">    </span>
<span class="sd">    ``in`` files are FITS files which are used as input to an ``iraf`` fucntion. They are created immediately, and will exist untill the :mod:`~AstroObject.iraftools` cleanup stage (:meth:`iraf.done &lt;AstroObject.iraftools.IRAFTools.done&gt;`).</span>

<span class="sd">.. describe:: out-file</span>
<span class="sd">    </span>
<span class="sd">    :meth:`outfile &lt;IRAFToolsMixin.iraf.infile&gt;` and :meth:`outatfile &lt;IRAFToolsMixin.iraf.outatfile&gt;`</span>
<span class="sd">    </span>
<span class="sd">    ``out`` files are FITS files which will be output targets for ``iraf``. As such, the filename returned does not point to an existing FITS file. Instead, the filename points to a potential file which will be re-read by the parent **stack** during the cleanup stage (:meth:`iraf.done &lt;AstroObject.iraftools.IRAFTools.done&gt;`).</span>

<span class="sd">.. describe:: mod-file</span>
<span class="sd">    </span>
<span class="sd">    :meth:`modfile &lt;IRAFToolsMixin.iraf.modfile&gt;` and :meth:`modatfile &lt;IRAFToolsMixin.iraf.modatfile&gt;`</span>
<span class="sd">    </span>
<span class="sd">    ``mod`` files are FITS files which will be modified in-place by ``iraf``. These files are created immediately, just like ``in`` files, and are re-loaded automatically during the cleanup stage (:meth:`iraf.done &lt;AstroObject.iraftools.IRAFTools.done&gt;`). To prevent these **frames** from overwriting their original content, use the ``append=`` keyword to append a string to the new **frame** name. You could also make a copy of the original **frame** using</span>
<span class="sd">    ::</span>
<span class="sd">	</span>
<span class="sd">    	Data[&quot;newname&quot;] = Data[&quot;oldname&quot;]</span>
<span class="sd">	</span>
<span class="sd">    Since **frame** labels are required to be unique, this will copy the old **frame**.</span>

<span class="sd">These file types can be generated individually, or as @lists using functions provided by :class:`IRAFToolsMixin`.</span>

<span class="sd">Example use of :mod:`iraftools`</span>
<span class="sd">-------------------------------</span>

<span class="sd">The best way to understand how :mod:`iraftools` works is to check out the walkthrough example. The example goes a few of the commonly used :mod:`iraftools` methods, and explains their basic operation. The example is explained in detail in :ref:`IRAFToolsWalkthough`.</span>

<span class="sd">.. literalinclude:: /../../Examples/iraf-simple.py</span>

<span class="sd">A full examle program can be seen in :ref:`IRAFToolsExample`.</span>

<span class="sd">:class:`IRAFToolsMixin` – Intefrace to :class:`IRAFTools`</span>
<span class="sd">---------------------------------------------------------</span>

<span class="sd">.. autoclass::</span>
<span class="sd">    AstroObject.iraftools.IRAFToolsMixin</span>
<span class="sd">    </span>
<span class="sd">    .. method:: iraf.inpfile(framename=None,extension=&#39;.fits&#39;)</span>
<span class="sd">        </span>
<span class="sd">        Returns a filename for a ``fits`` file from the given framename which can be used as input for IRAF tasks. This method should be used for files which will not be modified, as modifications will not be captured by the system. For files which are input, but will be modified, use :meth:`imod`.</span>
<span class="sd">        </span>
<span class="sd">        :param framename: The name of the **frame** to use for input.</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :returns: Filename for use with PyRAF</span>
<span class="sd">    </span>
<span class="sd">    .. method:: iraf.outfile(framename=None,extension=&#39;.fits&#39;,append=None)</span>
<span class="sd">        </span>
<span class="sd">        Returns a filename for a ``fits`` file from the given framename which can be used for output for IRAF tasks. The file is not created, but will be read back into this **stack** when :meth:`idone` is called.</span>
<span class="sd">        </span>
<span class="sd">        :param framename: The name of the **frame** to use for output.</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :param append: A string to append to the frame names</span>
<span class="sd">        :returns: Filename for use with PyRAF</span>
<span class="sd">    </span>
<span class="sd">    .. method:: iraf.modfile(framename=None,newframename=None,extension=&#39;.fits&#39;,append=None)</span>
<span class="sd">    </span>
<span class="sd">        Returns a filename for a ``fits`` file from the given framename which can be used as input for IRAF tasks which modify a file in-place. The file will be reloaded when :meth:`idone` is called.</span>
<span class="sd">        </span>
<span class="sd">        :param framename: The name of the **frame** to use for input.</span>
<span class="sd">        :param newframename: The name of the **frame** to use fo the output. If ``None``, uses ``framename``</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :param append: A string to be appended tp the new frame name.</span>
<span class="sd">        :returns: Filename for use with PyRAF</span>
<span class="sd">        </span>
<span class="sd">    .. method:: iraf.inpatlist(*framenames,extension=&#39;.fits&#39;)</span>
<span class="sd">    </span>
<span class="sd">        Returns a filename for an &quot;@&quot;-list. The &quot;@&quot;-list lists fits files for each frame provided. These fitsfiles are created automatically. The &quot;@&quot;-list should not be used for in-place modification, for that, use :meth:`imodat`.</span>
<span class="sd">        </span>
<span class="sd">        :param framenames: Names of frames to be included in the &quot;@&quot;-list.</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :retunrs: Filename of the &quot;@&quot;-list</span>
<span class="sd">        </span>
<span class="sd">    .. method:: iraf.outatlist(*framenames,append=None,extension=&#39;.fits&#39;)</span>
<span class="sd">        </span>
<span class="sd">        Returns a filename for an &quot;@&quot;-list. The &quot;@&quot;-list lists fits files for each frame provided. These fits-files will be output destinations. They will be re-read into the object when :meth:`idone` is called.</span>
<span class="sd">        </span>
<span class="sd">        :param framenames: Names of frames to be included in the &quot;@&quot;-list.</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :param append: A string to append to the frame names</span>
<span class="sd">        :retunrs: Filename of the &quot;@&quot;-list</span>
<span class="sd">        </span>
<span class="sd">    .. method:: iraf.modatlist(*framenames,append=None,extension=&#39;.fits&#39;)</span>
<span class="sd">        </span>
<span class="sd">        Returns a filename for an &quot;@&quot;-list. The &quot;@&quot;-list lists fits files for each frame provided. These fits-files will be in-place modification destinations. They will be re-read into the object when :meth:`idone` is called.</span>
<span class="sd">        </span>
<span class="sd">        :param framenames: Names of frames to be included in the &quot;@&quot;-list.</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :param append: A string to append to the frame names</span>
<span class="sd">        :retunrs: Filename of the &quot;@&quot;-list</span>
<span class="sd">        </span>
<span class="sd">    .. method:: iraf.done()</span>
<span class="sd">    </span>
<span class="sd">        Cleans up the temporary files, reloading any files which need reloading. Should be called after the IRAF command has completed, before attempting to re-use the stage.</span>

<span class="sd">.. _IRAFTools_Shortcuts:</span>

<span class="sd">Shortcuts for :class:`IRAFToolsMixin`</span>
<span class="sd">-------------------------------------</span>

<span class="sd">The following shortcuts are bound directly to the **stack** object by the :meth:`IRAFToolsMixin.set_instance_methods`</span>

<span class="sd">- :meth:`iraf.infile &lt;IRAFToolsMixin.iraf.infile&gt;` = :meth:`iin`</span>
<span class="sd">- :meth:`iraf.outfile &lt;IRAFToolsMixin.iraf.outfile&gt;` = :meth:`iout`</span>
<span class="sd">- :meth:`iraf.modfile &lt;IRAFToolsMixin.iraf.modfile&gt;` = :meth:`imod`</span>
<span class="sd">- :meth:`iraf.inatfile &lt;IRAFToolsMixin.iraf.inatfile&gt;` = :meth:`iinat`</span>
<span class="sd">- :meth:`iraf.outatfile &lt;IRAFToolsMixin.iraf.outatfile&gt;` = :meth:`ioutat`</span>
<span class="sd">- :meth:`iraf.modatfile &lt;IRAFToolsMixin.iraf.modatfile&gt;` = :meth:`imodat`</span>

<span class="sd">:class:`IRAFTools` – API Implementation of IRAF Tools</span>
<span class="sd">-----------------------------------------------------</span>

<span class="sd">.. autoclass::</span>
<span class="sd">    AstroObject.iraftools.IRAFTools</span>
<span class="sd">    :members:</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Standard Scipy Toolkits</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyfits</span> <span class="kn">as</span> <span class="nn">pf</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>

<span class="c"># Scipy Extras</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="c"># Standard Python Modules</span>
<span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="c"># Submodules from this system</span>
<span class="kn">from</span> <span class="nn">.Utilities</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.AstroObjectBase</span> <span class="kn">import</span> <span class="n">BaseStack</span><span class="p">,</span> <span class="n">Mixin</span>
<span class="kn">from</span> <span class="nn">.AstroFITS</span> <span class="kn">import</span> <span class="n">FITSFrame</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="n">getVersion</span><span class="p">()</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">IRAFSet</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">__module__</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">__name__</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">IRAFFileSet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An IRAF File Set&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IRAFFileSet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dbase</span><span class="p">,</span><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="n">dparent</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">directory</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dparent</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">directory</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;IRAF File Set created with directory </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Name of FileSet is open&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If the FileSet is open&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span>
        
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close this IRAFFileSet&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="s">&quot;May only close an open IRAFFileSet&quot;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;IRAF File Set closed with directory </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="bp">False</span>
        
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a new filename for this set.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="s">&quot;File objects can only be created from open sets.&quot;</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
        <span class="n">fileobj</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span><span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filename</span>
        

<div class="viewcode-block" id="IRAFTools"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools">[docs]</a><span class="k">class</span> <span class="nc">IRAFTools</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class for managing interaction with IRAF&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Object</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IRAFTools</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Object</span><span class="p">,</span><span class="n">BaseStack</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Object must be an instance of </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">BaseStack</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">Object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="n">__module__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IRAFFileSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">IRAFFileSet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">FITSFrame</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">dataClasses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">dataClasses</span> <span class="o">+=</span> <span class="p">[</span><span class="n">FITSFrame</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the reference to object, to prevent circularity&quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">IRAFFileSet</span>
    
    <span class="nd">@property</span>
<div class="viewcode-block" id="IRAFTools.active"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.active">[docs]</a>    <span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If the set is active for this group of iraftools&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">IRAFSet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        </div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="IRAFTools.set"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unique new set stored at the module level.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">IRAFSet</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">IRAFSet</span><span class="o">.</span><span class="n">open</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">IRAFSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IRAFFileSet</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">IRAFSet</span>
    </div>
<div class="viewcode-block" id="IRAFTools.wrap"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.wrap">[docs]</a>    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap the function below this with the done protocol&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">newfunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
             <span class="n">rvalue</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
             <span class="k">return</span> <span class="n">rvalue</span>
        <span class="n">newfunc</span> <span class="o">=</span> <span class="n">make_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span><span class="n">newfunc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newfunc</span>
    </div>
<div class="viewcode-block" id="IRAFTools.directory"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.directory">[docs]</a>    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the IRAFSet directory for this object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dbase</span><span class="p">,</span><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="n">dparent</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dbase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">directory</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dparent</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="n">directory</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t find directory to set: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">dbase</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_directory</span> <span class="o">=</span> <span class="bp">None</span>
        </div>
<div class="viewcode-block" id="IRAFTools.inpfile"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.inpfile">[docs]</a>    <span class="k">def</span> <span class="nf">inpfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">framename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="s">&#39;.fits&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a filename for a ``fits`` file from the given framename which can be used as input for IRAF tasks. This method should be used for files which will not be modified, as modifications will not be captured by the system. For files which are input, but will be modified, use :meth:`modfile`.</span>
<span class="sd">        </span>
<span class="sd">        :param framename: The name of the **frame** to use for input.</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :returns: Filename for use with PyRAF</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">framename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">framename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">framename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="n">framename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frames</span><span class="o">=</span><span class="p">[</span><span class="n">framename</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;Created infile for frame </span><span class="si">%s</span><span class="s"> named </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">framename</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">filename</span>
    </div>
    <span class="n">infile</span> <span class="o">=</span> <span class="n">inpfile</span>
        
<div class="viewcode-block" id="IRAFTools.outfile"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.outfile">[docs]</a>    <span class="k">def</span> <span class="nf">outfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">framename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">append</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="s">&#39;.fits&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a filename for a ``fits`` file from the given framename which can be used for output for IRAF tasks. The file is not created, but will be read back into this **stack** when :meth:`done` is called.</span>
<span class="sd">        </span>
<span class="sd">        :param framename: The name of the **frame** to use for output.</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :param append: A string to append to the frame names</span>
<span class="sd">        :returns: Filename for use with PyRAF</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">framename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">framename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">framename</span> <span class="o">+</span> <span class="s">&quot;-iraf&quot;</span>
        <span class="k">if</span> <span class="n">append</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">framename</span> <span class="o">+=</span> <span class="n">append</span>
        <span class="k">if</span> <span class="n">framename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Cannot register frame </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s"> for output, frame already exists in </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">framename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">))</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="n">framename</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">FITSFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">framename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="p">[</span><span class="n">framename</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;Created outfile for frame </span><span class="si">%s</span><span class="s"> named </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">framename</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">filename</span>
        </div>
<div class="viewcode-block" id="IRAFTools.modfile"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.modfile">[docs]</a>    <span class="k">def</span> <span class="nf">modfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">framename</span><span class="p">,</span><span class="n">newframename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">append</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="s">&#39;.fits&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a filename for a ``fits`` file from the given framename which can be used as input for IRAF tasks which modify a file in-place. The file will be reloaded when :meth:`done` is called.</span>
<span class="sd">        </span>
<span class="sd">        :param framename: The name of the **frame** to use for input.</span>
<span class="sd">        :param newframename: The name of the **frame** to use fo the output. If ``None``, uses ``framename``</span>
<span class="sd">        :param extension: The file extension to use.</span>
<span class="sd">        :param append: A string to be appended tp the new frame name.</span>
<span class="sd">        :returns: Filename for use with PyRAF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">newframename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">newframename</span> <span class="o">=</span> <span class="n">framename</span>
        <span class="k">if</span> <span class="n">append</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">newframename</span> <span class="o">+=</span> <span class="n">append</span>
        <span class="k">if</span> <span class="n">framename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">framename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">framename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="n">framename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frames</span><span class="o">=</span><span class="p">[</span><span class="n">framename</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newframename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">FITSFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">newframename</span><span class="p">))</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;Created modfile for frame </span><span class="si">%s</span><span class="s"> named </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">framename</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="p">[</span><span class="n">newframename</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">return</span> <span class="n">filename</span>
        </div>
    <span class="k">def</span> <span class="nf">_atfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">framenames</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generic atfile creation routine&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">framenames</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">framenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="n">atlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">filename</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="s">&#39;.list&#39;</span><span class="p">)</span>

        <span class="n">function</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;function&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Must provide a filename creation function&quot;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">atlist</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">framename</span> <span class="ow">in</span> <span class="n">framenames</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">framename</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;Created atlist for frames </span><span class="si">%s</span><span class="s"> named </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">framenames</span><span class="p">,</span><span class="n">atlist</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&quot;@&quot;</span> <span class="o">+</span> <span class="n">atlist</span>

<div class="viewcode-block" id="IRAFTools.modatlist"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.modatlist">[docs]</a>    <span class="k">def</span> <span class="nf">modatlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">framenames</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;File list for modification&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atfile</span><span class="p">(</span><span class="o">*</span><span class="n">framenames</span><span class="p">,</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modfile</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    </div>
    <span class="n">modatfile</span> <span class="o">=</span> <span class="n">modatlist</span>
    
<div class="viewcode-block" id="IRAFTools.inpatlist"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.inpatlist">[docs]</a>    <span class="k">def</span> <span class="nf">inpatlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">framenames</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a filename with @ appended, for a file which lists a series of fitsfiles.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atfile</span><span class="p">(</span><span class="o">*</span><span class="n">framenames</span><span class="p">,</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infile</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    </div>
    <span class="n">inatfile</span> <span class="o">=</span> <span class="n">inpatlist</span>
    
<div class="viewcode-block" id="IRAFTools.outatlist"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.outatlist">[docs]</a>    <span class="k">def</span> <span class="nf">outatlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">framenames</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a filename with @ appended, for a file which lists a series of fitsfiles&quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atfile</span><span class="p">(</span><span class="o">*</span><span class="n">framenames</span><span class="p">,</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        </div>
    <span class="n">outatfile</span> <span class="o">=</span> <span class="n">outatlist</span>
        
<div class="viewcode-block" id="IRAFTools.done"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.done">[docs]</a>    <span class="k">def</span> <span class="nf">done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finish the IRAF framename.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">framename</span><span class="p">,</span><span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="n">framename</span><span class="o">=</span><span class="n">framename</span><span class="p">,</span><span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;Collected file for frame </span><span class="si">%s</span><span class="s"> named </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">framename</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;States created: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">frames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collect</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="IRAFTools.set_instance_methods"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFTools.set_instance_methods">[docs]</a>    <span class="k">def</span> <span class="nf">set_instance_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the instance shortcut methods on the object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">iin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">iout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">iinat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inatfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">ioutat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outatfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">imod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">imodat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modatfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">idone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">idir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span>
</div></div>
<div class="viewcode-block" id="IRAFToolsMixin"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.IRAFToolsMixin">[docs]</a><span class="k">class</span> <span class="nc">IRAFToolsMixin</span><span class="p">(</span><span class="n">Mixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This mixin class enables IRAFTools. By default, tools are only enabled in the ``class.iraf`` namespace, so to call :meth:`~iraf.infile`, use :meth:`iraf.infile &lt;IRAFToolsMixin.iraf.infile&gt;`. To use the IRAFTools shortcuts (documented in :ref:`IRAFTools_Shortcuts`), pass ``shortcuts=True`` to any constructor form for each object, or explicitly call :meth:`iraf.set_instance_methods`.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">shortcuts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;shortcuts&#39;</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IRAFToolsMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iraf</span> <span class="o">=</span> <span class="n">IRAFTools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shortcuts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iraf</span><span class="o">.</span><span class="n">set_instance_methods</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="s">&#39;iraf&#39;</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">iraf</span> <span class="o">=</span> <span class="n">IRAFTools</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;shortcuts&#39;</span><span class="p">,</span><span class="bp">False</span><span class="p">):</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">iraf</span><span class="o">.</span><span class="n">set_instance_methods</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">obj</span>
        
    <span class="k">def</span> <span class="nf">__array_finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;NDArray Finalization function&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IRAFToolsMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__array_finalize__</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iraf</span> <span class="o">=</span> <span class="n">IRAFTools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
        
</div>
<div class="viewcode-block" id="UseIRAFTools"><a class="viewcode-back" href="../../iraftools.html#AstroObject.iraftools.UseIRAFTools">[docs]</a><span class="k">def</span> <span class="nf">UseIRAFTools</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class wrapper which allows classes to use IRAF tools. Takes a single parameter, the class name which should have IRAF tools, and creates a dummy class which activates IRAF tools during initialization.</span>
<span class="sd">    </span>
<span class="sd">    :param klass: The class to apply :mod:`iraftools` to.</span>
<span class="sd">    </span>
<span class="sd">    Example::</span>
<span class="sd">        </span>
<span class="sd">        from AstroObject.iraftools import UseIRAFTools</span>
<span class="sd">        from AstroObject.AstroImage import ImageStack</span>
<span class="sd">        ImageStack = UseIRAFTools(ImageStack)</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="n">BaseStack</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">_IRAFClass</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object which contains the IRAF Tools&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">iraf</span> <span class="o">=</span> <span class="n">IRAFTools</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">iraf</span><span class="o">.</span><span class="n">set_instance_methods</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">obj</span>
    <span class="k">return</span> <span class="n">_IRAFClass</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">AstroObject 0.5-b3 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Alexander Rudy.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>